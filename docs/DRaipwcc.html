<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Yizhe Xu, Peirong Hao, Ravinder Singh, Kevin Ying, Adam Bress, Tom Greene">
<meta name="dcterms.date" content="2026-01-25">

<title>Augmented Inverse Probability Weighted Complete Case Estimator for Survival Analysis – Target Trial Emulation and Causal Inference Tutorials</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-aea124b32290bd4fa8d6570d276e2e09.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Target Trial Emulation and Causal Inference Tutorials</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-tutorials" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Tutorials</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-tutorials">    
        <li>
    <a class="dropdown-item" href="./TTEdemoSig.html">
 <span class="dropdown-text">Preparing Analysis Data by Emulating A Single Target Trial</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./TTEdemoSeq.html">
 <span class="dropdown-text">Preparing Analysis Data by Emulating A Sequence of Target Trials</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./IntentionToTreat.html">
 <span class="dropdown-text">Introduction to Causal Inference and Intention to Treat Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./PerProtocol.html">
 <span class="dropdown-text">Per-protocol Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./DRpseudo.html">
 <span class="dropdown-text">Doubly Robust Estimation of Average Treatment Effects Using Pseudo Observations</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./DRaipwcc.html">
 <span class="dropdown-text">Augmented Inverse Probability Weighted Complete Case Estimator for Survival Outcomes</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./IFvar.pdf">
 <span class="dropdown-text">Estimating the Variance of Inverse-probability weighted risk ratios using inflence functions</span></a>
  </li>  
    </ul>
  </li>
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link active" data-scroll-target="#background">Background</a></li>
  <li><a href="#augmented-inverse-probability-weighted-complete-case-estimator" id="toc-augmented-inverse-probability-weighted-complete-case-estimator" class="nav-link" data-scroll-target="#augmented-inverse-probability-weighted-complete-case-estimator">Augmented Inverse Probability Weighted Complete Case Estimator</a></li>
  <li><a href="#aipwcc-estimator-versus-pseudo-observation-based-dr-estimator" id="toc-aipwcc-estimator-versus-pseudo-observation-based-dr-estimator" class="nav-link" data-scroll-target="#aipwcc-estimator-versus-pseudo-observation-based-dr-estimator">AIPWCC estimator versus pseudo-observation-based DR estimator</a></li>
  <li><a href="#implementation-of-the-aipwcc-estimator" id="toc-implementation-of-the-aipwcc-estimator" class="nav-link" data-scroll-target="#implementation-of-the-aipwcc-estimator">Implementation of the AIPWCC estimator</a>
  <ul class="collapse">
  <li><a href="#data-generation" id="toc-data-generation" class="nav-link" data-scroll-target="#data-generation">Data Generation</a></li>
  <li><a href="#using-r-package" id="toc-using-r-package" class="nav-link" data-scroll-target="#using-r-package">Using R package</a></li>
  <li><a href="#crude-estimation" id="toc-crude-estimation" class="nav-link" data-scroll-target="#crude-estimation">Crude estimation</a></li>
  <li><a href="#evaluate-the-performance-of-aipwcc-estimator" id="toc-evaluate-the-performance-of-aipwcc-estimator" class="nav-link" data-scroll-target="#evaluate-the-performance-of-aipwcc-estimator">Evaluate the performance of AIPWCC estimator</a></li>
  <li><a href="#model-misspecification-scenarios" id="toc-model-misspecification-scenarios" class="nav-link" data-scroll-target="#model-misspecification-scenarios">Model misspecification scenarios</a></li>
  </ul></li>
  <li><a href="#funding" id="toc-funding" class="nav-link" data-scroll-target="#funding">Funding</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/UQualityCausal/TTECausalR/blob/main/DRaipwcc.Rmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/UQualityCausal/TTECausalR/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Augmented Inverse Probability Weighted Complete Case Estimator for Survival Analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Yizhe Xu<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>, Peirong Hao, Ravinder Singh, Kevin Ying, Adam Bress, Tom Greene </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 25, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">collapse =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">comment =</span> <span class="st">"#&gt;"</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">message =</span> <span class="cn">FALSE</span>,    </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">warning =</span> <span class="cn">FALSE</span> </span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(truncnorm)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survival)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(adjustedCurves)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(MASS)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dagitty)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parallel)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(future.apply)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(future)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>n_cores <span class="ot">&lt;-</span> <span class="fu">detectCores</span>() <span class="sc">-</span> <span class="dv">2</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background</h2>
<p>We continue our previous discussion on doubly robust (DR) estimators for time-to-event outcomes using <a href="https://uqualitycausal.github.io/TTECausalR/DRpseudo.html">pseudo observations</a> but focus on the situation where the loss to follow-up depends on pre-baseline and post-baseline characteristics, referred to as <em>informative censoring</em>. For example, patients who are sicker at baseline or who develop treatment-related adverse events may be more likely to drop out early. In such situations, the censoring mechanism must be explicitly modeled as a function of baseline and time-dependent covariates.</p>
</section>
<section id="augmented-inverse-probability-weighted-complete-case-estimator" class="level2">
<h2 class="anchored" data-anchor-id="augmented-inverse-probability-weighted-complete-case-estimator">Augmented Inverse Probability Weighted Complete Case Estimator</h2>
<p>We use similar notations as before and consider <span class="math inline">\(n\)</span> independent and identically distributed individuals indexed by <span class="math inline">\(i\)</span>. Let <span class="math inline">\(D\)</span> denote a binary treatment (0 or 1), <span class="math inline">\(T_d\)</span> denote the potential survival time under treatment <span class="math inline">\(D=d\)</span>, <span class="math inline">\(C\)</span> the censoring time, <span class="math inline">\(U_i=\mathrm{min}(T_i, C_i)\)</span>, and <span class="math inline">\(\boldsymbol{Z}\)</span> denotes pre-baseline covariates.</p>
<p>Let <span class="math inline">\(S_d(t)\)</span> be the survival function under treatment <span class="math inline">\(d\)</span> at time <span class="math inline">\(t\)</span>. We define the average treatment effect (ATE) as the difference in survival probabilities between treatment groups at time <span class="math inline">\(t\)</span>, i.e., <span class="math inline">\(S_1(t)-S_0(t)\)</span>. Without loss of generality, we focus our illustration on estimating <span class="math inline">\(S_1(t)\)</span>, and <span class="math inline">\(S_0(t)\)</span> can be estimated analogously.</p>
<p>Note that we only get to observe <span class="math inline">\(T_1\)</span> when <span class="math inline">\(D=1\)</span> and <span class="math inline">\(\Delta = 1(C \ge T_1)\)</span>; otherwise <span class="math inline">\(T_1\)</span> is missing or coarsened. Further, this is monotone coarsening <span class="citation" data-cites="DR-semiparam">(<a href="#ref-DR-semiparam" role="doc-biblioref">Tsiatis 2006</a>)</span> and we assume coarsening at random, i.e., <span class="math inline">\((D,C) \perp T_1|Z\)</span>. Intuitively, coarsening in this case is induced by observed treatment and loss to follow-up, with treatment assignment depends only on pre-baseline characteristics and loss to follow-up relies on both pre- and post-baseline covariates, that is, informative censoring.</p>
<p>To handle bias induced by monotonic data coarsening, we apply the augmented inverse probability weighted Complete Case (AIPWCC) estimator described in <span class="citation" data-cites="Bai2013">Bai, Tsiatis, and O’Brien (<a href="#ref-Bai2013" role="doc-biblioref">2013</a>)</span>. Specifically, the AIPWCC estimator</p>
<ul>
<li>accounts for coarsening due to treatment assignment using the <strong>propensity score model</strong>: <span class="math inline">\(\hat{e}(\boldsymbol{Z})=P(D=1|Z)\)</span></li>
<li>handles informative censoring using the treatment-specific <strong>censoring model</strong>: <span class="math inline">\(\hat{K}_1^c(r, Z) = P(C \ge r|Z, D=1)\)</span><br>
</li>
<li>leverages the <strong>outcome regression model</strong> like in standard DR estimators: <span class="math inline">\(\hat{m}_1(\boldsymbol{Z})=P(T_1&gt;r|Z)\)</span></li>
</ul>
<p>The optimal AIPWCC estimator is <span class="math display">\[ \hat{S}_1(u) = \frac{1}{n} \sum_{i=1}^{n} \left[ \frac{D_i\mathbb{1}(U_i\ge u)}{\hat{e}(Z_i)\hat{K}_1^c(u, Z_i)}-\left\{\frac{D_i-\hat{e}(Z_i)}{\hat{e}(Z_i)} \hat{m}_1(u, Z_i)\right\}+\int_0^u \frac{D_i}{\hat{e}(Z_i)}\frac{\mathrm{d}M_{1, i}^c(r, Z_i)}{\hat{K}_1^c(r, Z_i)}\frac{\hat{m}_1(u, Z_i)}{\hat{m}_1(r, Z_i)}\right]\]</span> where <span class="math inline">\(\mathrm{d}M_{1, i}^c(r, Z_i) = \frac{\mathrm{d}N^c(r)-\lambda_1^c(r, Z_i)Y(r)}{\hat{K}_1^c(r, Z_i)}\)</span> is the martingale increment for the censoring distribution with <span class="math inline">\(N^c(r)=\mathbb{1}(U\le r, \Delta=0)\)</span>, <span class="math inline">\(Y(r)=\mathbb{1}(U\ge r)\)</span>, and <span class="math inline">\(\lambda_1^c(r, Z_i)=\frac{-\mathrm{d} \mathrm{log}\hat{K}_1^c(r, Z_i)}{\mathrm{d}r}\)</span>.</p>
<p>The first term in the bracket in the equation above is the inverse probability weighted complete case term. The second term is the outcome-regression augmentation term in a standard DR estimator and has a mean of zero if the PS model is correct. The third term is the censoring augmentation term and also has a mean of zero if the censoring model is correct. The third term is essential to making the estimator robust to misspecification in the censoring model when the outcome model is correct.</p>
<p>The AIPWCC estimator is doubly robust:</p>
<ul>
<li>If the coarsening models, including the propensity score model and censoring model, are correct</li>
<li>If the outcome model, that is, the conditional survival distribution is correct</li>
</ul>
<p>The variance of the AIPWCC estimator for <span class="math inline">\(\hat{S}_1(u)\)</span> can be estimated using Equation (5) in <span class="citation" data-cites="Bai2013">Bai, Tsiatis, and O’Brien (<a href="#ref-Bai2013" role="doc-biblioref">2013</a>)</span>. If all three models (PS model, censoring model, and outcome model) are correctly specified, the estimator is locally <strong>semiparametric efficient</strong>, meaning it attains the smallest possible variance. One caveat is that if the outcome model or coarsening models are misspecified, the AIPWCC estimator for ATE remains unbiased, but the standard sandwich variance estimator in Equation (5) is conservative. In such cases, a bootstrap estimator of the asymptotic variance is recommended.</p>
</section>
<section id="aipwcc-estimator-versus-pseudo-observation-based-dr-estimator" class="level2">
<h2 class="anchored" data-anchor-id="aipwcc-estimator-versus-pseudo-observation-based-dr-estimator">AIPWCC estimator versus pseudo-observation-based DR estimator</h2>
<ul>
<li>The pseudo-observation-based DR estimator proposed by <span class="citation" data-cites="DR-pseudo">Wang (<a href="#ref-DR-pseudo" role="doc-biblioref">2018</a>)</span> can only be applied when loss to follow-up is completely at random since the pseudo outcomes are estimated using the KM estimator where covariate adjustment is not allowed</li>
<li>Even though the pseudo-observation-based DR estimator can be extended to handle covariate-dependent censoring <span class="citation" data-cites="Binder2014">(<a href="#ref-Binder2014" role="doc-biblioref">Binder, Gerds, and Andersen 2014</a>)</span>, it models the censoring mechanism and outcome within the same model</li>
<li>In contrast, the AIPWCC estimator allows to model the censoring and outcome separately</li>
<li>In addition, the AIPWCC estimator includes an augmentation term for censoring to make it robust to censoring model misspecification and gain efficiency when the censoring model is correct</li>
</ul>
</section>
<section id="implementation-of-the-aipwcc-estimator" class="level2">
<h2 class="anchored" data-anchor-id="implementation-of-the-aipwcc-estimator">Implementation of the AIPWCC estimator</h2>
<p>We now demonstrate how to implement the AIPWCC estimator under the informative censoring scenario.</p>
<section id="data-generation" class="level3">
<h3 class="anchored" data-anchor-id="data-generation">Data Generation</h3>
<p>We first simulate the data according to the variable relationships depicted in the directed acyclic graph (DAG) below.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>dag <span class="ot">&lt;-</span> <span class="fu">dagitty</span>(<span class="st">"dag {</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="st">  Z1 -&gt; Treatment</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="st">  Z2 -&gt; Treatment</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="st">  Z3 -&gt; Treatment</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="st">  Z4 -&gt; Treatment</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="st">  Z1 -&gt; Death</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="st">  Z2 -&gt; Death</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="st">  Z6 -&gt; Death</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="st">  Z7 -&gt; Death</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="st">  Treatment -&gt; Death</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="st">}"</span>)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="fu">coordinates</span>(dag) <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="at">Z3 =</span> <span class="dv">0</span>, <span class="at">Z4 =</span> <span class="dv">0</span>, <span class="at">Z1 =</span> <span class="dv">1</span>, <span class="at">Z2 =</span> <span class="dv">1</span>, <span class="at">Treatment =</span> <span class="fl">1.5</span>, <span class="at">Death =</span> <span class="dv">3</span>, <span class="at">Z6 =</span> <span class="dv">4</span>, <span class="at">Z7 =</span> <span class="dv">4</span>),</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="at">Z3 =</span> <span class="fl">0.8</span>, <span class="at">Z4 =</span> <span class="fl">0.4</span>, <span class="at">Z1 =</span> <span class="fl">0.7</span>, <span class="at">Z2 =</span> <span class="fl">0.3</span>, <span class="at">Treatment =</span> <span class="fl">0.5</span>, <span class="at">Death =</span> <span class="fl">0.5</span>, <span class="at">Z6 =</span> <span class="fl">0.7</span>, <span class="at">Z7 =</span> <span class="fl">0.3</span>)</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dag)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="DRaipwcc_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="288"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>alpha_0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.5</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>alpha_Z1 <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>alpha_Z2 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>alpha_Z3 <span class="ot">&lt;-</span> <span class="fl">0.5</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>alpha_Z4 <span class="ot">&lt;-</span> <span class="fl">0.5</span> </span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>beta_0 <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">2.55</span>      </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>beta_D <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.8</span> </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>beta_Z1 <span class="ot">&lt;-</span> <span class="fl">1.25</span> </span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>beta_Z2 <span class="ot">&lt;-</span> <span class="fl">1.8</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>beta_Z6 <span class="ot">&lt;-</span> <span class="fl">1.8</span> </span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>beta_Z7 <span class="ot">&lt;-</span> <span class="fl">1.3</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>generate_data_inf <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">n =</span> <span class="dv">500</span>) {</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  Z1 <span class="ot">&lt;-</span> <span class="fu">rtruncnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>, <span class="at">a =</span> <span class="sc">-</span><span class="fl">0.5</span>, <span class="at">b =</span> <span class="fl">0.5</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  Z2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>  Z3 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>  Z4 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>  Z5 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  Z6 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  Z7 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  Z8 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  Z9 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  logit_p <span class="ot">&lt;-</span> alpha_0 <span class="sc">+</span> alpha_Z1 <span class="sc">*</span> Z1 <span class="sc">+</span> alpha_Z2 <span class="sc">*</span> Z2 <span class="sc">+</span> alpha_Z3 <span class="sc">*</span> Z3 <span class="sc">+</span> alpha_Z4 <span class="sc">*</span> Z4</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">plogis</span>(logit_p) <span class="co"># exp(logit_p) / (1 + exp(logit_p))</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  D <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(n, <span class="dv">1</span>, p) <span class="co"># Treatment indicator</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  hazard <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta_0 <span class="sc">+</span> beta_D <span class="sc">*</span> D <span class="sc">+</span> beta_Z1 <span class="sc">*</span> Z1 <span class="sc">+</span> beta_Z2 <span class="sc">*</span> Z2 <span class="sc">+</span> beta_Z6 <span class="sc">*</span> Z6 <span class="sc">+</span> beta_Z7 <span class="sc">*</span> Z7)</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>  T_event <span class="ot">&lt;-</span> <span class="fu">rexp</span>(n, <span class="at">rate =</span> hazard)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  hazard_cen <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.05</span> <span class="sc">*</span> D <span class="sc">+</span> <span class="fl">0.05</span> <span class="sc">*</span> Z1 <span class="sc">+</span> <span class="fl">0.05</span> <span class="sc">*</span> Z2 <span class="sc">+</span> <span class="fl">0.05</span> <span class="sc">*</span> Z8 <span class="sc">+</span> <span class="fl">0.05</span> <span class="sc">*</span> Z9)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="co">#hazard_cen &lt;- 0.0001</span></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  T_censor <span class="ot">&lt;-</span> <span class="fu">rexp</span>(n, <span class="at">rate =</span> hazard_cen)</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  T_admin <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">5</span>, n)</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  Time <span class="ot">&lt;-</span> <span class="fu">pmin</span>(T_event, T_censor, T_admin)</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  Event <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(T_event <span class="sc">&lt;=</span> T_censor <span class="sc">&amp;</span> T_event <span class="sc">&lt;=</span> T_admin)</span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="co">#Censored &lt;- as.numeric(T_event &gt; T_censor &amp; T_event &lt;= T_admin) # Censoring indicator???</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  Censored <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> Event</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">data.frame</span>(<span class="at">Z1 =</span> Z1, <span class="at">Z2 =</span> Z2, <span class="at">Z3 =</span> Z3, <span class="at">Z4 =</span> Z4, <span class="at">Z5 =</span> Z5, <span class="at">Z6 =</span> Z6, <span class="at">Z7 =</span> Z7, <span class="at">Z8 =</span> Z8, <span class="at">Z9 =</span> Z9, <span class="at">D =</span> D, <span class="at">Time =</span> Time, <span class="at">Event =</span> Event, <span class="at">Censored =</span> Censored))</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">generate_data_inf</span>()</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(data<span class="sc">$</span>Z1, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Baseline value of Z1"</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(data<span class="sc">$</span>Z2, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Baseline value of Z2"</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(data<span class="sc">$</span>Z3, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Baseline value of Z3"</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(data<span class="sc">$</span>Z4, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Baseline value of Z4"</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(data<span class="sc">$</span>Z5, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Baseline value of Z5"</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(data<span class="sc">$</span>Z6, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Baseline value of Z6"</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(data<span class="sc">$</span>Z7, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Baseline value of Z7"</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(data<span class="sc">$</span>Z8, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Baseline value of Z8"</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(data<span class="sc">$</span>Z9, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Baseline value of Z9"</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(data<span class="sc">$</span>D, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Treatment indicator (1 = treated, 0 = control)"</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(data<span class="sc">$</span>Time, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Time index for longitudinal records"</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="fu">attr</span>(data<span class="sc">$</span>Event, <span class="st">"label"</span>) <span class="ot">&lt;-</span> <span class="st">"Event indicator (1 = event occurred, 0 = otherwise)"</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co">#attr(data$Censored, "label") &lt;- "Censoring indicator (1 = censored, 0 = otherwise)"???</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>get_label <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>  lbl <span class="ot">&lt;-</span> <span class="fu">attr</span>(x, <span class="st">"label"</span>, <span class="at">exact =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(lbl)) <span class="st">""</span> <span class="cf">else</span> <span class="fu">as.character</span>(lbl)</span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>dict <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">Variable =</span> <span class="fu">names</span>(data),</span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">Meaning  =</span> <span class="fu">vapply</span>(data, get_label, <span class="fu">character</span>(<span class="dv">1</span>)),</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">check.names =</span> <span class="cn">FALSE</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(dict, <span class="at">caption =</span> <span class="st">"Data Dictionary"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>) </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Data Dictionary</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Variable</th>
<th style="text-align: left;">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Z1</td>
<td style="text-align: left;">Baseline value of Z1</td>
</tr>
<tr class="even">
<td style="text-align: left;">Z2</td>
<td style="text-align: left;">Baseline value of Z2</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Z3</td>
<td style="text-align: left;">Baseline value of Z3</td>
</tr>
<tr class="even">
<td style="text-align: left;">Z4</td>
<td style="text-align: left;">Baseline value of Z4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Z5</td>
<td style="text-align: left;">Baseline value of Z5</td>
</tr>
<tr class="even">
<td style="text-align: left;">Z6</td>
<td style="text-align: left;">Baseline value of Z6</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Z7</td>
<td style="text-align: left;">Baseline value of Z7</td>
</tr>
<tr class="even">
<td style="text-align: left;">Z8</td>
<td style="text-align: left;">Baseline value of Z8</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Z9</td>
<td style="text-align: left;">Baseline value of Z9</td>
</tr>
<tr class="even">
<td style="text-align: left;">D</td>
<td style="text-align: left;">Treatment indicator (1 = treated, 0 = control)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Time</td>
<td style="text-align: left;">Time index for longitudinal records</td>
</tr>
<tr class="even">
<td style="text-align: left;">Event</td>
<td style="text-align: left;">Event indicator (1 = event occurred, 0 = otherwise)</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Censored</td>
<td style="text-align: left;"></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(data<span class="sc">$</span>Time)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 0.000532 0.540231 2.077864 2.446897 5.000000 5.000000</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data<span class="sc">$</span>Event)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   0   1 </span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 320 180</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data<span class="sc">$</span>D)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   0   1 </span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 306 194</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>censored_subjects <span class="ot">&lt;-</span> data[data<span class="sc">$</span>Censored <span class="sc">==</span> <span class="dv">1</span>, ]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>(early_dropout <span class="ot">&lt;-</span> <span class="fu">sum</span>(censored_subjects<span class="sc">$</span>Time <span class="sc">&lt;</span> <span class="dv">5</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 182</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>(admin_censored <span class="ot">&lt;-</span> <span class="fu">sum</span>(censored_subjects<span class="sc">$</span>Time <span class="sc">&gt;=</span> <span class="dv">5</span>))</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] 138</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Among the 320 subjects with no events, 182 are early dropouts and 138 are administratively censored. Administrative censoring is random, so no additional modeling is needed. Early dropout could be covariate-dependent or occur completely at random, and we assume it is informative in this data generation.</p>
<p>With the simulation above, we can calculate the true survival probability.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>get_true_survival <span class="ot">&lt;-</span> <span class="cf">function</span>(data, t, D) {</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  hazard <span class="ot">&lt;-</span> <span class="fu">exp</span>(beta_0 <span class="sc">+</span> beta_D <span class="sc">*</span> D <span class="sc">+</span> beta_Z1 <span class="sc">*</span> data<span class="sc">$</span>Z1 <span class="sc">+</span> beta_Z2 <span class="sc">*</span> data<span class="sc">$</span>Z2 <span class="sc">+</span> beta_Z6 <span class="sc">*</span> data<span class="sc">$</span>Z6 <span class="sc">+</span> beta_Z7 <span class="sc">*</span> data<span class="sc">$</span>Z7)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  survival_probs <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="sc">-</span>hazard <span class="sc">*</span> t) <span class="co"># Baseline hazard is constant under an exponential survival model</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>(survival_probs)) </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>We generate multiple datasets to compute the true ATEs at prespecified time points and corresponding 95% confidence intervals (CIs) using percentiles.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>n_datasets <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>datasets <span class="ot">&lt;-</span> <span class="fu">replicate</span>(n_datasets, <span class="fu">generate_data_inf</span>(), <span class="at">simplify =</span> <span class="cn">FALSE</span>)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>times <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>)</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>true_ate_samples <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n_datasets, <span class="at">ncol =</span> <span class="fu">length</span>(times))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_datasets) {</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute potential survival probabilities by setting treatment to 1 and 0 for all individuals</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  true_surv_1 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(times, <span class="cf">function</span>(t) <span class="fu">get_true_survival</span>(datasets[[i]], t, <span class="at">D =</span> <span class="dv">1</span>))</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>  true_surv_0 <span class="ot">&lt;-</span> <span class="fu">sapply</span>(times, <span class="cf">function</span>(t) <span class="fu">get_true_survival</span>(datasets[[i]], t, <span class="at">D =</span> <span class="dv">0</span>))</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate ATE as difference in survival probabilities</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  true_ate_samples[i, ] <span class="ot">&lt;-</span> true_surv_1 <span class="sc">-</span> true_surv_0</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>true_ate_mean <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(true_ate_samples)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>true_ate_ci_lower <span class="ot">&lt;-</span> <span class="fu">apply</span>(true_ate_samples, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.025</span>)</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>true_ate_ci_upper <span class="ot">&lt;-</span> <span class="fu">apply</span>(true_ate_samples, <span class="dv">2</span>, quantile, <span class="at">probs =</span> <span class="fl">0.975</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>results_true <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">ATE =</span> true_ate_mean, <span class="at">ci_lower =</span> true_ate_ci_lower, <span class="at">ci_upper =</span> true_ate_ci_upper)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="using-r-package" class="level3">
<h3 class="anchored" data-anchor-id="using-r-package">Using R package</h3>
<p>First, we implement the AIPWCC estimator using the <em>adjustedsurv</em> function in the <a href="https://cran.r-project.org/web/packages/adjustedCurves/adjustedCurves.pdf">adjustedCurves</a> R package.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>aipwcc_dr_ate_pkg <span class="ot">&lt;-</span> <span class="cf">function</span>(data, times, <span class="at">ps_correct =</span> <span class="cn">TRUE</span>, <span class="at">or_correct =</span> <span class="cn">TRUE</span>, </span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">cen_correct =</span> <span class="cn">TRUE</span>, <span class="at">variance =</span> <span class="st">"asymptotic"</span>) {</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>D <span class="ot">&lt;-</span> <span class="fu">factor</span>(data<span class="sc">$</span>D, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Propensity score model</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (ps_correct) {</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    ps_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(D <span class="sc">~</span> Z1 <span class="sc">+</span> Z2 <span class="sc">+</span> Z3 <span class="sc">+</span> Z4, <span class="at">data =</span> data, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    ps_model <span class="ot">&lt;-</span> <span class="fu">glm</span>(D <span class="sc">~</span> Z5, <span class="at">data =</span> data, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Censoring model </span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Note: Event == 0 (Censored == 1) includes both loss to follow-up and administrative censoring</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (cen_correct) {</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    cen_model <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(Time, Event <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">~</span> D <span class="sc">+</span> Z1 <span class="sc">+</span> Z2 <span class="sc">+</span> Z8 <span class="sc">+</span> Z9, <span class="at">data =</span> data, <span class="at">x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    cen_model <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(Time, Event <span class="sc">==</span> <span class="dv">0</span>) <span class="sc">~</span> D <span class="sc">+</span> Z5, <span class="at">data =</span> data, <span class="at">x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Outcome regression (Cox proportional hazard model)</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (or_correct) {</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>    or_model <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(Time, Event) <span class="sc">~</span> D <span class="sc">+</span> Z1 <span class="sc">+</span> Z2 <span class="sc">+</span> Z6 <span class="sc">+</span> Z7, <span class="at">data =</span> data, <span class="at">x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    or_model <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(Time, Event) <span class="sc">~</span> D <span class="sc">+</span> Z5, <span class="at">data =</span> data, <span class="at">x =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># AIPWCC estimator for survival probabilities </span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (variance <span class="sc">==</span> <span class="st">"asymptotic"</span>) { <span class="co"># Use asymptotic variance</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    adj_surv <span class="ot">&lt;-</span> <span class="fu">adjustedsurv</span>(</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> data,</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">variable =</span> <span class="st">"D"</span>,</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">ev_time =</span> <span class="st">"Time"</span>,</span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">event =</span> <span class="st">"Event"</span>,</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"aiptw"</span>,</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>      <span class="at">treatment_model =</span> ps_model,</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">censoring_model =</span> cen_model,</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">outcome_model =</span> or_model,</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">times =</span> times, </span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">conf_int =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">conf_level =</span> <span class="fl">0.95</span>,</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a>      <span class="at">bootstrap =</span> <span class="cn">FALSE</span>) </span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (variance <span class="sc">==</span> <span class="st">"bootstrap"</span>){ <span class="co"># Use bootstrap variance</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    adj_surv <span class="ot">&lt;-</span> <span class="fu">adjustedsurv</span>(</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> data,</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">variable =</span> <span class="st">"D"</span>,</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">ev_time =</span> <span class="st">"Time"</span>,</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>      <span class="at">event =</span> <span class="st">"Event"</span>,</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">method =</span> <span class="st">"aiptw"</span>,</span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">treatment_model =</span> ps_model,</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">censoring_model =</span> cen_model,</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">outcome_model =</span> or_model,</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">times =</span> times,</span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">conf_int =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">conf_level =</span> <span class="fl">0.95</span>,</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">bootstrap =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_boot =</span> <span class="dv">100</span>) </span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Treatment effect is defined as the difference in survival probabilities.</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>  ate_results <span class="ot">&lt;-</span> <span class="fu">adjusted_curve_diff</span>(</span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">adj =</span> adj_surv,</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">group_1 =</span> <span class="st">"1"</span>,  <span class="co"># Treated group</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">group_2 =</span> <span class="st">"0"</span>,  <span class="co"># Control group</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf_int =</span> <span class="cn">TRUE</span>,</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">conf_level =</span> <span class="fl">0.95</span>)</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract survival probabilities at times of interest</span></span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>  ate_at_times <span class="ot">&lt;-</span> ate_results[ate_results<span class="sc">$</span>time <span class="sc">%in%</span> times, ]</span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">ATE =</span> ate_at_times<span class="sc">$</span>diff, <span class="at">ci_lower =</span> ate_at_times<span class="sc">$</span>ci_lower, <span class="at">ci_upper =</span> ate_at_times<span class="sc">$</span>ci_upper))</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>We estimate the ATEs at prespecified time points and corresponding 95% confidence intervals (CIs).</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>results_asymp <span class="ot">&lt;-</span> <span class="fu">aipwcc_dr_ate_pkg</span>(data, times, <span class="at">variance =</span> <span class="st">"asymptotic"</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># results_boot &lt;- aipwcc_dr_ate_pkg(data, times, variance = "bootstrap")</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># results_package_tbl &lt;- data.frame(</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">#   Time = paste0("T = ", times),</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   True = sprintf("%.3f (%.3f, %.3f)", results_true$ATE, results_true$ci_lower, results_true$ci_upper),</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   Asymptotic = sprintf("%.3f (%.3f, %.3f)", results_asymp$ATE, results_asymp$ci_lower, results_asymp$ci_upper),</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   Bootstrap = sprintf("%.3f (%.3f, %.3f)", results_boot$ATE, results_boot$ci_lower, results_boot$ci_upper)</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(results_package_tbl,</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="co">#       caption = "ATE (95% CI)",</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co">#       col.names = c("Time", "True", "Asymptotic", "Bootstrap"),</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="co">#       align = c('c', 'c', 'c', 'c')) %&gt;%</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a><span class="co">#   kable_styling(full_width = FALSE, font_size = 12)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="crude-estimation" class="level3">
<h3 class="anchored" data-anchor-id="crude-estimation">Crude estimation</h3>
<p>Fit a crude Cox model with no covariate or propensity score adjustment to show the amount of confounding bias in our data</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>crude_cox_estimator <span class="ot">&lt;-</span> <span class="cf">function</span>(data, times) {</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  crude_cox <span class="ot">&lt;-</span> <span class="fu">coxph</span>(<span class="fu">Surv</span>(Time, Event) <span class="sc">~</span> D, <span class="at">data =</span> data)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  treatment_effect <span class="ot">&lt;-</span> <span class="fu">coef</span>(crude_cox)[<span class="st">"D"</span>]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  base_surv <span class="ot">&lt;-</span> <span class="fu">survfit</span>(crude_cox)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  s0 <span class="ot">&lt;-</span> <span class="fu">summary</span>(base_surv, <span class="at">times =</span> times, <span class="at">extend =</span> <span class="cn">TRUE</span>)<span class="sc">$</span>surv</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Survival for treated group: S_baseline^exp(beta_D)</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  surv_1 <span class="ot">&lt;-</span> s0<span class="sc">^</span><span class="fu">exp</span>(treatment_effect)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Survival for control group: S_baseline^exp(0) </span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  surv_0 <span class="ot">&lt;-</span> s0</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  ATE <span class="ot">&lt;-</span> surv_1 <span class="sc">-</span> surv_0</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">ATE =</span> ATE))</span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>results_crude <span class="ot">&lt;-</span> <span class="fu">crude_cox_estimator</span>(data, times)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="evaluate-the-performance-of-aipwcc-estimator" class="level3">
<h3 class="anchored" data-anchor-id="evaluate-the-performance-of-aipwcc-estimator">Evaluate the performance of AIPWCC estimator</h3>
<p>We use the datasets generated previously to calculate RMSE, bias, and variance.</p>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(multisession, <span class="at">workers =</span> n_cores)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>calculate_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(datasets, true_ate_samples, times, <span class="at">method =</span> <span class="st">"package"</span>, <span class="at">variance =</span> <span class="st">"asymptotic"</span>, </span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                              <span class="at">ps_correct =</span> <span class="cn">TRUE</span>, <span class="at">or_correct =</span> <span class="cn">TRUE</span>, <span class="at">cen_correct =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  n_datasets <span class="ot">&lt;-</span> <span class="fu">length</span>(datasets)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  ate <span class="ot">&lt;-</span> <span class="fu">future_lapply</span>(<span class="dv">1</span><span class="sc">:</span>n_datasets, <span class="cf">function</span>(i) {</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(survival)</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(adjustedCurves)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    est_results <span class="ot">&lt;-</span> <span class="cf">switch</span>(</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>      method,</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>      <span class="st">"package"</span> <span class="ot">=</span> <span class="fu">aipwcc_dr_ate_pkg</span>(datasets[[i]], times, <span class="at">variance =</span> variance, </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">ps_correct =</span> ps_correct, <span class="at">or_correct =</span> or_correct, <span class="at">cen_correct =</span> cen_correct),</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">"crude"</span> <span class="ot">=</span> <span class="fu">crude_cox_estimator</span>(datasets[[i]], times),</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"Unknown: "</span>, method))</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    est_results<span class="sc">$</span>ATE</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">future.seed =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>  ate_all <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, ate)</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>  bias <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(ate_all <span class="sc">-</span> true_ate_samples)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>  variance <span class="ot">&lt;-</span> <span class="fu">apply</span>(ate_all, <span class="dv">2</span>, var)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>  rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">colMeans</span>((ate_all <span class="sc">-</span> true_ate_samples)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">bias =</span> bias, <span class="at">variance =</span> variance, <span class="at">rmse =</span> rmse))</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="model-misspecification-scenarios" class="level3">
<h3 class="anchored" data-anchor-id="model-misspecification-scenarios">Model misspecification scenarios</h3>
<p>To illustrate the robustness of the AIPWCC estimator to model misspecification, we compare the following scenarios:</p>
<ul>
<li><p>Scenario 1: The outcome model, the propensity score model, and the censoring model are all correctly specified</p></li>
<li><p>Scenario 2: The outcome model and propensity score model are correctly specified, while the censoring model is misspecified</p></li>
<li><p>Scenario 3: The outcome model and censoring model are correctly specified, while the propensity score model is misspecified</p></li>
<li><p>Scenario 4: The outcome model is correctly specified, while the propensity score model and censoring model are both misspecified</p></li>
<li><p>Scenario 5: The propensity score model and censoring model are correctly specified, but the outcome model is misspecified</p></li>
<li><p>Scenario 6: The propensity score model is correctly specified, but the outcome model and censoring model are both misspecified</p></li>
<li><p>Scenario 7: The censoring model is correctly specified, but the outcome model and propensity score model are both misspecified</p></li>
<li><p>Scenario 8: All three models are misspecified</p></li>
</ul>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario 1: All models correct</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>metrics_1_asymp <span class="ot">&lt;-</span> <span class="fu">calculate_metrics</span>(datasets, true_ate_samples, times, <span class="at">method =</span> <span class="st">"package"</span>, <span class="at">variance =</span> <span class="st">"asymptotic"</span>,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">ps_correct =</span> <span class="cn">TRUE</span>, <span class="at">cen_correct =</span> <span class="cn">TRUE</span>, <span class="at">or_correct =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># metrics_1_boot &lt;- calculate_metrics(datasets, true_ate_samples, times, method = "package", variance = "bootstrap",</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="co">#                                     ps_correct = TRUE, cen_correct = TRUE, or_correct = TRUE)</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario 2: PS correct, Cen incorrect, OR correct</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>metrics_2_asymp <span class="ot">&lt;-</span> <span class="fu">calculate_metrics</span>(datasets, true_ate_samples, times, <span class="at">method =</span> <span class="st">"package"</span>, <span class="at">variance =</span> <span class="st">"asymptotic"</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">ps_correct =</span> <span class="cn">TRUE</span>, <span class="at">cen_correct =</span> <span class="cn">FALSE</span>, <span class="at">or_correct =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co"># metrics_2_boot &lt;- calculate_metrics(datasets, true_ate_samples, times, method = "package", variance = "bootstrap",</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#                                     ps_correct = TRUE, cen_correct = FALSE, or_correct = TRUE)</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario 3: PS incorrect, Cen correct, OR correct</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>metrics_3_asymp <span class="ot">&lt;-</span> <span class="fu">calculate_metrics</span>(datasets, true_ate_samples, times, <span class="at">method =</span> <span class="st">"package"</span>, <span class="at">variance =</span> <span class="st">"asymptotic"</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">ps_correct =</span> <span class="cn">FALSE</span>, <span class="at">cen_correct =</span> <span class="cn">TRUE</span>, <span class="at">or_correct =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a><span class="co"># metrics_3_boot &lt;- calculate_metrics(datasets, true_ate_samples, times, method = "package", variance = "bootstrap",</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co">#                                     ps_correct = FALSE, cen_correct = TRUE, or_correct = TRUE)</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario 4: PS incorrect, Cen incorrect, OR correct</span></span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>metrics_4_asymp <span class="ot">&lt;-</span> <span class="fu">calculate_metrics</span>(datasets, true_ate_samples, times, <span class="at">method =</span> <span class="st">"package"</span>, <span class="at">variance =</span> <span class="st">"asymptotic"</span>,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">ps_correct =</span> <span class="cn">FALSE</span>, <span class="at">cen_correct =</span> <span class="cn">FALSE</span>, <span class="at">or_correct =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a><span class="co"># metrics_4_boot &lt;- calculate_metrics(datasets, true_ate_samples, times, method = "package", variance = "bootstrap",</span></span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a><span class="co">#                                     ps_correct = FALSE, cen_correct = FALSE, or_correct = TRUE)</span></span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario 5: PS correct, Cen correct, OR incorrect</span></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>metrics_5_asymp <span class="ot">&lt;-</span> <span class="fu">calculate_metrics</span>(datasets, true_ate_samples, times, <span class="at">method =</span> <span class="st">"package"</span>, <span class="at">variance =</span> <span class="st">"asymptotic"</span>,</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">ps_correct =</span> <span class="cn">TRUE</span>, <span class="at">cen_correct =</span> <span class="cn">TRUE</span>, <span class="at">or_correct =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a><span class="co"># metrics_5_boot &lt;- calculate_metrics(datasets, true_ate_samples, times, method = "package", variance = "bootstrap",</span></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="co">#                                     ps_correct = TRUE, cen_correct = TRUE, or_correct = FALSE)</span></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario 6: PS correct, Cen incorrect, OR incorrect</span></span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>metrics_6_asymp <span class="ot">&lt;-</span> <span class="fu">calculate_metrics</span>(datasets, true_ate_samples, times, <span class="at">method =</span> <span class="st">"package"</span>, <span class="at">variance =</span> <span class="st">"asymptotic"</span>,</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">ps_correct =</span> <span class="cn">TRUE</span>, <span class="at">cen_correct =</span> <span class="cn">FALSE</span>, <span class="at">or_correct =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a><span class="co"># metrics_6_boot &lt;- calculate_metrics(datasets, true_ate_samples, times, method = "package", variance = "bootstrap",</span></span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a><span class="co">#                                     ps_correct = TRUE, cen_correct = FALSE, or_correct = FALSE)</span></span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario 7: PS incorrect, Cen correct, OR incorrect</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>metrics_7_asymp <span class="ot">&lt;-</span> <span class="fu">calculate_metrics</span>(datasets, true_ate_samples, times, <span class="at">method =</span> <span class="st">"package"</span>, <span class="at">variance =</span> <span class="st">"asymptotic"</span>,</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">ps_correct =</span> <span class="cn">FALSE</span>, <span class="at">cen_correct =</span> <span class="cn">TRUE</span>, <span class="at">or_correct =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a><span class="co"># metrics_7_boot &lt;- calculate_metrics(datasets, true_ate_samples, times, method = "package", variance = "bootstrap",</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="co">#                                     ps_correct = FALSE, cen_correct = TRUE, or_correct = FALSE)</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario 8: All models incorrect</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>metrics_8_asymp <span class="ot">&lt;-</span> <span class="fu">calculate_metrics</span>(datasets, true_ate_samples, times, <span class="at">method =</span> <span class="st">"package"</span>, <span class="at">variance =</span> <span class="st">"asymptotic"</span>,</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">ps_correct =</span> <span class="cn">FALSE</span>, <span class="at">cen_correct =</span> <span class="cn">FALSE</span>, <span class="at">or_correct =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a><span class="co"># metrics_8_boot &lt;- calculate_metrics(datasets, true_ate_samples, times, method = "package", variance = "bootstrap",</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a><span class="co">#                                     ps_correct = FALSE, cen_correct = FALSE, or_correct = FALSE)</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Scenario 0: Crude Cox</span></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a>metrics_crude <span class="ot">&lt;-</span> <span class="fu">calculate_metrics</span>(datasets, true_ate_samples, times, <span class="at">method =</span> <span class="st">"crude"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>scenarios <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"1: All Correct"</span>,</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"2: PS Correct, Cen Incorrect, OR Correct"</span>,</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"3: PS Incorrect, Cen Correct, OR Correct"</span>,</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"4: PS Incorrect, Cen Incorrect, OR Correct"</span>,</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"5: PS Correct, Cen Correct, OR Incorrect"</span>,</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"6: PS Correct, Cen Incorrect, OR Incorrect"</span>,</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"7: PS Incorrect, Cen Correct, OR Incorrect"</span>,</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"8: All Incorrect"</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine values across all time points into a single string</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>format_values <span class="ot">&lt;-</span> <span class="cf">function</span>(vec) {</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste</span>(<span class="fu">sprintf</span>(<span class="st">"%.4f"</span>, vec), <span class="at">collapse =</span> <span class="st">", "</span>)</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a><span class="co"># RMSE table</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>rmse_asymp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">format_values</span>(metrics_1_asymp<span class="sc">$</span>rmse), <span class="fu">format_values</span>(metrics_2_asymp<span class="sc">$</span>rmse), </span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>                <span class="fu">format_values</span>(metrics_3_asymp<span class="sc">$</span>rmse), <span class="fu">format_values</span>(metrics_4_asymp<span class="sc">$</span>rmse),</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>                <span class="fu">format_values</span>(metrics_5_asymp<span class="sc">$</span>rmse), <span class="fu">format_values</span>(metrics_6_asymp<span class="sc">$</span>rmse), </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>                <span class="fu">format_values</span>(metrics_7_asymp<span class="sc">$</span>rmse), <span class="fu">format_values</span>(metrics_8_asymp<span class="sc">$</span>rmse))</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>rmse_asymp</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "0.0290, 0.0279, 0.0295" "0.0290, 0.0279, 0.0296" "0.0278, 0.0282, 0.0294"</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4] "0.0277, 0.0281, 0.0294" "0.0401, 0.0411, 0.0428" "0.0400, 0.0409, 0.0427"</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [7] "0.0985, 0.1058, 0.1113" "0.0984, 0.1058, 0.1112"</span></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co"># rmse_boot &lt;- c(format_values(metrics_1_boot$rmse), format_values(metrics_2_boot$rmse),</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a><span class="co">#                format_values(metrics_3_boot$rmse), format_values(metrics_4_boot$rmse),</span></span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="co">#                format_values(metrics_5_boot$rmse), format_values(metrics_6_boot$rmse),</span></span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a><span class="co">#                format_values(metrics_7_boot$rmse), format_values(metrics_8_boot$rmse))</span></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a><span class="co"># rmse_table &lt;- data.frame(Scenario = scenarios, Asymptotic = rmse_asymp, Bootstrap = rmse_boot)</span></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(rmse_table,</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co">#       col.names = c("Scenario", "T = 1, 2, 3", "T = 1, 2, 3"),</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="co">#       caption = "Performance of the estimator (RMSE)",</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="co">#       align = c('c', 'c', 'c')) %&gt;%</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="co">#   kable_styling(full_width = FALSE, font_size = 12) %&gt;%</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="co">#   add_header_above(c(" " = 1, "Asymptotic" = 1, "Bootstrap" = 1)) %&gt;%</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="co">#   footnote(general = paste0("Crude Cox: ", format_values(metrics_crude$rmse)), general_title = "")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Bias table</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>bias_asymp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">format_values</span>(metrics_1_asymp<span class="sc">$</span>bias), <span class="fu">format_values</span>(metrics_2_asymp<span class="sc">$</span>bias), </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>                <span class="fu">format_values</span>(metrics_3_asymp<span class="sc">$</span>bias), <span class="fu">format_values</span>(metrics_4_asymp<span class="sc">$</span>bias),</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                <span class="fu">format_values</span>(metrics_5_asymp<span class="sc">$</span>bias), <span class="fu">format_values</span>(metrics_6_asymp<span class="sc">$</span>bias), </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>                <span class="fu">format_values</span>(metrics_7_asymp<span class="sc">$</span>bias), <span class="fu">format_values</span>(metrics_8_asymp<span class="sc">$</span>bias))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>bias_asymp</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "-0.0037, 0.0017, -0.0002"  "-0.0037, 0.0017, -0.0001" </span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [3] "-0.0049, 0.0005, 0.0008"   "-0.0048, 0.0004, 0.0007"  </span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [5] "-0.0051, 0.0006, -0.0011"  "-0.0050, 0.0006, -0.0010" </span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [7] "-0.0894, -0.0966, -0.1017" "-0.0893, -0.0966, -0.1017"</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># bias_boot &lt;- c(format_values(metrics_1_boot$bias), format_values(metrics_2_boot$bias),</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="co">#                format_values(metrics_3_boot$bias), format_values(metrics_4_boot$bias),</span></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a><span class="co">#                format_values(metrics_5_boot$bias), format_values(metrics_6_boot$bias),</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co">#                format_values(metrics_7_boot$bias), format_values(metrics_8_boot$bias))</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a><span class="co"># bias_table &lt;- data.frame(Scenario = scenarios, Asymptotic = bias_asymp, Bootstrap = bias_boot)</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(bias_table,</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co">#       col.names = c("Scenario", "T = 1, 2, 3", "T = 1, 2, 3"),</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co">#       caption = "Performance of the estimator (Bias)",</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co">#       align = c('c', 'c', 'c')) %&gt;%</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   kable_styling(full_width = FALSE, font_size = 12) %&gt;%</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   add_header_above(c(" " = 1, "Asymptotic" = 1, "Bootstrap" = 1)) %&gt;%</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a><span class="co">#   footnote(general = paste0("Crude Cox: ", format_values(metrics_crude$bias)), general_title = "")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="cell">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variance table</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>var_asymp <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">format_values</span>(metrics_1_asymp<span class="sc">$</span>variance), <span class="fu">format_values</span>(metrics_2_asymp<span class="sc">$</span>variance), </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>               <span class="fu">format_values</span>(metrics_3_asymp<span class="sc">$</span>variance), <span class="fu">format_values</span>(metrics_4_asymp<span class="sc">$</span>variance),</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>               <span class="fu">format_values</span>(metrics_5_asymp<span class="sc">$</span>variance), <span class="fu">format_values</span>(metrics_6_asymp<span class="sc">$</span>variance), </span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>               <span class="fu">format_values</span>(metrics_7_asymp<span class="sc">$</span>variance), <span class="fu">format_values</span>(metrics_8_asymp<span class="sc">$</span>variance))</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>var_asymp</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] "0.0008, 0.0008, 0.0009" "0.0008, 0.0008, 0.0009" "0.0007, 0.0008, 0.0009"</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [4] "0.0007, 0.0008, 0.0009" "0.0016, 0.0017, 0.0018" "0.0016, 0.0017, 0.0018"</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [7] "0.0017, 0.0019, 0.0021" "0.0017, 0.0019, 0.0020"</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="co"># var_boot &lt;- c(format_values(metrics_1_boot$variance), format_values(metrics_2_boot$variance),</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co">#               format_values(metrics_3_boot$variance), format_values(metrics_4_boot$variance),</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co">#               format_values(metrics_5_boot$variance), format_values(metrics_6_boot$variance),</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="co">#               format_values(metrics_7_boot$variance), format_values(metrics_8_boot$variance))</span></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a><span class="co"># var_table &lt;- data.frame(Scenario = scenarios, Asymptotic = var_asymp, Bootstrap = var_boot)</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a><span class="co"># kable(var_table,</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a><span class="co">#       col.names = c("Scenario", "T = 1, 2, 3", "T = 1, 2, 3"),</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a><span class="co">#       caption = "Performance of the estimator (Variance)",</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co">#       align = c('c', 'c', 'c')) %&gt;%</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   kable_styling(full_width = FALSE, font_size = 12) %&gt;%</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a><span class="co">#   add_header_above(c(" " = 1, "Asymptotic" = 1, "Bootstrap" = 1)) %&gt;%</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co">#   footnote(general = paste0("Crude Cox: ", format_values(metrics_crude$variance)), general_title = "")</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
</section>
<section id="funding" class="level2">
<h2 class="anchored" data-anchor-id="funding">Funding</h2>
<p>This work was supported by Utah Clinical &amp; Translational Science Institute (CTSI) Translational Innovation Pilot (TIP) Program Award (NCATS UM1TR004409).</p>
</section>
<section id="references" class="level2">




</section>


<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Bai2013" class="csl-entry" role="listitem">
Bai, Xiaofei, Anastasios A. Tsiatis, and Sean M. O’Brien. 2013. <span>“Doubly-Robust Estimators of Treatment-Specific Survival Distributions in Observational Studies with Stratified Sampling.”</span> <em>Biometrics</em> 69 (December): 830–39. <a href="https://doi.org/10.1111/biom.12076">https://doi.org/10.1111/biom.12076</a>.
</div>
<div id="ref-Binder2014" class="csl-entry" role="listitem">
Binder, Nadine, Thomas A. Gerds, and Per Kragh Andersen. 2014. <span>“Pseudo-Observations for Competing Risks with Covariate Dependent Censoring.”</span> <em>Lifetime Data Analysis</em> 20 (April): 303–15. <a href="https://doi.org/10.1007/s10985-013-9247-7">https://doi.org/10.1007/s10985-013-9247-7</a>.
</div>
<div id="ref-DR-semiparam" class="csl-entry" role="listitem">
Tsiatis, Anastasios A. 2006. <em>Semiparametric Theory and Missing Data</em>. Springer Series in Statistics. New York, NY: Springer. <a href="https://doi.org/10.1007/0-387-37345-4">https://doi.org/10.1007/0-387-37345-4</a>.
</div>
<div id="ref-DR-pseudo" class="csl-entry" role="listitem">
Wang, Jixian. 2018. <span>“A Simple, Doubly Robust, Efficient Estimator for Survival Functions Using Pseudo Observations.”</span> <em>Pharmaceutical Statistics</em> 17 (1): 38–48.
</div>
</div></section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Corresponding author: yizhe.xu@hsc.utah.edu<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Corresponding author: yizhe.xu@hsc.utah.edu<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>Corresponding author: yizhe.xu@hsc.utah.edu<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/uqualitycausal\.github\.io\/TTECausalR\/");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/UQualityCausal/TTECausalR/blob/main/DRaipwcc.Rmd" class="toc-action"><i class="bi bi-github"></i>View source</a></li><li><a href="https://github.com/UQualityCausal/TTECausalR/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div></div></footer></body></html>